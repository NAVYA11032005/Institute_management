{% extends 'm.html' %}
{% load static %}

{% block content %}
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet" />
<style>
  /* Card container animation */
  .enrollment-card {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    opacity: 0;
    animation: fadeInUp 0.6s forwards;
  }
  /* Staggered animation delay for smoother feel */
  .enrollment-card:nth-child(odd) {
    animation-delay: 0.15s;
  }
  .enrollment-card:nth-child(even) {
    animation-delay: 0.3s;
  }
  @keyframes fadeInUp {
    0% {
      opacity: 0;
      transform: translateY(15px);
    }
    100% {
      opacity: 1;
      transform: translateY(0);
    }
  }
  /* Hover effect */
  .enrollment-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 12px 20px rgba(0,0,0,0.15);
    z-index: 1;
  }
  /* Card header colors based on enrollment status */
  .card-header.bg-success { background-color: #28a745 !important; }
  .card-header.bg-info { background-color: #17a2b8 !important; }
  .card-header.bg-secondary { background-color: #6c757d !important; }
  /* Payment remaining amounts in red */
  .text-danger { font-weight: bold; }
  /* Card responsive width fix */
  @media (min-width: 768px) {
    .col-md-6 {
      max-width: 48%;
      margin-bottom: 1.5rem;
    }
  }
  /* Improve badge appearance */
  .badge {
    font-weight: 600;
    font-size: 0.9rem;
  }
</style>

<div class="container-xxl flex-grow-1 container-p-y">

  <!-- Student Info Card -->
  <div class="row justify-content-center mb-4">
    <div class="col-md-7">
      <div class="card shadow-sm border-primary mb-4">
        <div class="card-header bg-primary text-white">
          <h4 class="mb-0"><i class="fas fa-user-graduate me-2"></i> Student Details</h4>
        </div>
        <div class="card-body">
          <div class="row mb-2"><div class="col-6 fw-bold">Student ID:</div><div class="col-6">{{ student.student_id|default:"-" }}</div></div>
          <div class="row mb-2"><div class="col-6 fw-bold">Full Name:</div><div class="col-6">{{ student.full_name }}</div></div>
          <div class="row mb-2"><div class="col-6 fw-bold">Email:</div><div class="col-6">{{ student.email }}</div></div>
          <div class="row mb-2"><div class="col-6 fw-bold">Contact:</div><div class="col-6">{{ student.contact }}</div></div>
          <div class="row mb-2"><div class="col-6 fw-bold">Emergency Contact:</div><div class="col-6">{{ student.emergency_contact_number|default:"-" }}</div></div>
          <div class="row mb-2"><div class="col-6 fw-bold">Address:</div><div class="col-6">{{ student.address|default:"-" }}</div></div>
          <div class="row mb-2"><div class="col-6 fw-bold">City:</div><div class="col-6">{{ student.city }}</div></div>
          <div class="row mb-2"><div class="col-6 fw-bold">State:</div><div class="col-6">{{ student.state }}</div></div>
          <div class="row mb-2"><div class="col-6 fw-bold">Pincode:</div><div class="col-6">{{ student.pincode }}</div></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Enrollment Cards -->
  <div class="row justify-content-center">
    <div class="col-md-10">
      <h4 class="mb-3 text-primary">Enrollments</h4>
      {% if enrollments %}
        <div class="row g-4">
          {% for enrollment in enrollments %}
          <div class="col-md-6 enrollment-card">
            <div class="card border-2 shadow-sm
              {% if enrollment.status == 'active' %} border-success
              {% elif enrollment.status == 'completed' %} border-info
              {% else %} border-secondary
              {% endif %}">
              <div class="card-header
                {% if enrollment.status == 'active' %} bg-success
                {% elif enrollment.status == 'completed' %} bg-info
                {% else %} bg-secondary
                {% endif %} text-white">
                <div class="d-flex justify-content-between align-items-center">
                  <span><i class="fas fa-book-open me-2"></i> {{ enrollment.course.course_name }}</span>
                  <span class="badge bg-light text-dark">Enroll ID: {{ enrollment.t_id }}</span>
                </div>
              </div>
              <div class="card-body small">
                <!-- Basic Info -->
                <div class="row mb-1"><div class="col-6 fw-bold">Status:</div><div class="col-6">{{ enrollment.get_status_display }}</div></div>
                <div class="row mb-1"><div class="col-6 fw-bold">Enrollment Date:</div><div class="col-6">{{ enrollment.enrollment_date|date:"d-m-Y" }}</div></div>
               
                <div class="row mb-1"><div class="col-6 fw-bold">Batch Time:</div><div class="col-6">{% if enrollment.batch_time %}{{ enrollment.batch_time|time:"h:i A" }}{% else %}-{% endif %}</div></div>

                <hr>

                <!-- Admission Fee Summary -->
                <div class="row mb-1"><div class="col-6 fw-bold">Admission Fee</div><div class="col-6">₹{{ enrollment.admission_fee|default:"0.00" }}</div></div>
                <div class="row mb-1"><div class="col-6 fw-bold">Admission Fee Paid</div><div class="col-6">₹{{ enrollment.admission_fee_paid|default:"0.00" }}</div></div>
                <div class="row mb-1"><div class="col-6 fw-bold text-danger">Admission Fee Remaining</div><div class="col-6 text-danger fw-bold">₹{{ enrollment.admission_fee_remaining|default:"0.00" }}</div></div>

                <hr>

                <!-- Course Fee Summary -->
                <div class="row mb-1"><div class="col-6 fw-bold">Course Fee </div><div class="col-6">₹{{ enrollment.course.course_fee|default:"0.00" }}</div></div>
                <div class="row mb-1"><div class="col-6 fw-bold">Course Fee Paid</div><div class="col-6">₹{{ enrollment.course_fee_paid|default:"0.00" }}</div></div>
                <div class="row mb-1"><div class="col-6 fw-bold text-danger">Course Fee Remaining</div><div class="col-6 text-danger fw-bold">₹{{ enrollment.course_fee_remaining|default:"0.00" }}</div></div>

                <hr>

                <!-- Overall Summary -->
                <div class="row mb-1"><div class="col-6 fw-bold">Final Amount</div><div class="col-6">₹{{ enrollment.final_amount|floatformat:2 }}</div></div>
                <div class="row mb-1"><div class="col-6 fw-bold">Total Amount Paid</div><div class="col-6">₹{{ enrollment.total_amount_paid|floatformat:2 }}</div></div>
                <div class="row mb-1"><div class="col-6 fw-bold text-danger">Total Remaining</div><div class="col-6 text-danger fw-bold">₹{{ enrollment.course_fee_remaining|floatformat:2 }}</div></div>

                <hr>

                <!-- Payment Info -->
                <div class="row mb-1"><div class="col-6 fw-bold">Payment Method:</div><div class="col-6">{{ enrollment.get_payment_method_display }}</div></div>
                <div class="row mb-1"><div class="col-6 fw-bold">Payment Mode:</div><div class="col-6">{{ enrollment.get_payment_mode_display }}</div></div>
                <div class="row mb-1"><div class="col-6 fw-bold">Notes:</div><div class="col-6">{{ enrollment.notes|default:"-" }}</div></div>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
      {% else %}
        <div class="alert alert-info mt-3 text-center">No enrollments found for this student.</div>
      {% endif %}

      <!-- Back Button -->
      <div class="text-center mt-4 mb-5">
        <a href="{% url 'student_list' %}" class="btn btn-secondary">
          <i class="fas fa-arrow-circle-left me-1"></i> Back to Student List
        </a>
      </div>
    </div>
 
{% endblock %}
